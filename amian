#!/bin/bash

set -e


AMIAN_VERSION=2.0
AMIAN_BUILD=2.0.11

apt update
apt -y install live-build





########### BEGIN CLEAN ###########
#lb clean
#rm -fr config
#rm -fr .build
#rm -fr auto
#rm -fr chroot
#rm -fr cache
#rm -fr local
########### END CLEAN ###########



########### BEGIN CONFIG ###########
lb config \
	--memtest memtest86+ \
        --mode debian \
        --distribution bullseye  \
        --bootloaders syslinux \
        --architectures amd64 \
        --debian-installer none \
        --binary-image iso-hybrid  \
	--mirror-bootstrap https://ftp.debian.org/debian/   \
	--mirror-binary https://ftp.debian.org/debian/      \
        --archive-areas "main contrib non-free" \
        --bootappend-live "boot=live timezone=Europe/Rome locales=en_US.UTF-8 keyboard-layouts=it username=user \
			   hostname=localhost user-fullname=user@localhost" \
########### END CONFIG ###########



########### BEGIN PACKAGES ###########
echo    "firefox-esr net-tools curl elinks git wget macchanger aircrack-ng vim inkscape gimp nmap iptraf vlc whois \
cryptsetup cryptmount task-gnome-desktop task-english" \
> config/package-lists/custom.list.chroot
########### END PACKAGES ###########



########### BEGIN FILES ###########
########### END FILES ###########



########### BEGIN BUILD HOOK ###########
cat > config/hooks/live/amian_hook_build.chroot << EOF
#!/bin/bash

set -e

EOF
########### END BUILD HOOK ###########



########### BEGIN BOOT HOOK ###########
mkdir -p config/includes.chroot_after_packages/lib/live/config
touch config/includes.chroot_after_packages/lib/live/config/amian_hook_boot.sh
cat > config/includes.chroot_after_packages/lib/live/config/amian_hook_boot.sh << EOF
#!/bin/bash

set -e

EOF
########### END BOOT HOOK ###########



########### BEGIN BUILD ###########
lb build
########### END BUILD ###########


